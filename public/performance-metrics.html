<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>IOTCNT - M√©tricas de Performance</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            font-size: 16px; /* Prevent iOS zoom */
        }

        .header {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 0.75rem 0;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .logo h1 {
            font-size: 1.25rem;
            font-weight: bold;
            color: #1f2937;
            text-align: center;
        }

        .nav-links {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
        }

        .nav-link {
            padding: 0.5rem 0.75rem;
            text-decoration: none;
            color: #6b7280;
            border-radius: 0.5rem;
            transition: all 0.2s;
            font-size: 0.875rem;
            min-height: 44px; /* Touch target */
            display: flex;
            align-items: center;
        }

        .nav-link:hover { background: #f3f4f6; color: #1f2937; }
        .nav-link.active { background: #3b82f6; color: white; }

        .main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .section {
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .metric-card {
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
        }

        .metric-value {
            font-size: 1.75rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .metric-value.good { color: #16a34a; }
        .metric-value.warning { color: #d97706; }
        .metric-value.critical { color: #dc2626; }

        .metric-label {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .chart-container {
            height: 200px;
            background: #f8fafc;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6b7280;
            margin: 1rem 0;
            font-size: 0.875rem;
        }

        .btn {
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 16px; /* Prevent iOS zoom */
            min-height: 44px; /* Touch target */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-primary { background: #3b82f6; color: white; }
        .btn-success { background: #16a34a; color: white; }
        .btn-warning { background: #d97706; color: white; }

        .performance-table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .performance-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 500px;
        }

        .performance-table th, .performance-table td {
            padding: 0.5rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.875rem;
        }

        .performance-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
            position: sticky;
            top: 0;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.5rem;
        }

        .status-indicator.good { background: #16a34a; }
        .status-indicator.warning { background: #d97706; }
        .status-indicator.critical { background: #dc2626; }

        /* Responsive breakpoints */
        @media (min-width: 480px) {
            .header-content { padding: 0 1.5rem; }
            .main { padding: 1.5rem; }
            .section {
                border-radius: 0.75rem;
                padding: 1.5rem;
                margin-bottom: 1.5rem;
            }
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1.25rem;
                margin-bottom: 2rem;
            }
            .metric-card {
                padding: 1.25rem;
                border-radius: 0.75rem;
            }
            .metric-value { font-size: 2rem; }
            .chart-container {
                height: 250px;
                font-size: 1rem;
            }
            .performance-table th, .performance-table td {
                padding: 0.75rem;
                font-size: 1rem;
            }
            .status-indicator {
                width: 12px;
                height: 12px;
            }
        }

        @media (min-width: 768px) {
            .header { padding: 1rem 0; }
            .header-content {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                padding: 0 2rem;
            }
            .logo h1 {
                font-size: 1.5rem;
                text-align: left;
            }
            .nav-links { justify-content: flex-end; }
            .nav-link {
                padding: 0.5rem 1rem;
                font-size: 1rem;
            }
            .main { padding: 2rem; }
            .section {
                padding: 2rem;
                margin-bottom: 2rem;
            }
            .metrics-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 1.5rem;
            }
            .chart-container { height: 300px; }
            .performance-table-container {
                overflow-x: visible;
            }
            .performance-table {
                min-width: auto;
            }
        }

        @media (min-width: 1024px) {
            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
            .metric-card { padding: 1.5rem; }
            .metric-value { font-size: 2.5rem; }
        }

        /* Accessibility & Dark Mode */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        @media (prefers-color-scheme: dark) {
            body { background: #111827; }
            .header { background: #1f2937; }
            .logo h1 { color: #f9fafb; }
            .nav-link { color: #d1d5db; }
            .nav-link:hover { background: #374151; color: #f9fafb; }
            .section {
                background: #1f2937;
                color: #f9fafb;
            }
            .metric-card {
                background: #374151;
                border-color: #4b5563;
            }
            .metric-label { color: #d1d5db; }
            .chart-container {
                background: #374151;
                color: #d1d5db;
            }
            .performance-table th {
                background: #374151;
                color: #f9fafb;
            }
            .performance-table td { color: #d1d5db; }
        }

        @media (prefers-contrast: high) {
            .btn { border: 2px solid currentColor; }
            .metric-card { border-width: 3px; }
            .status-indicator { border: 1px solid currentColor; }
        }

        /* Landscape orientation */
        @media (orientation: landscape) and (max-height: 500px) {
            .header { padding: 0.5rem 0; }
            .main { padding: 0.75rem; }
            .section { padding: 0.75rem; margin-bottom: 0.75rem; }
            .chart-container { height: 150px; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo"><h1>IOTCNT - M√©tricas de Performance</h1></div>
            <nav class="nav-links">
                <a href="/dashboard-admin.html" class="nav-link">Dashboard</a>
                <a href="/valve-control.html" class="nav-link">V√°lvulas</a>
                <a href="/performance-metrics.html" class="nav-link active">Performance</a>
                <a href="/login-iotcnt.html" class="nav-link">Sair</a>
            </nav>
        </div>
    </header>
    <main class="main">
        <div class="page-title">
            <h2>M√©tricas de Performance</h2>
            <p>Monitoriza√ß√£o detalhada da performance e efici√™ncia do sistema IOTCNT</p>
        </div>

        <div class="section">
            <h3>üìä M√©tricas Principais</h3>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value good" id="systemUptime">99.8%</div>
                    <div class="metric-label">Uptime do Sistema</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value good" id="responseTime">45ms</div>
                    <div class="metric-label">Tempo de Resposta M√©dio</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value warning" id="memoryUsage">68%</div>
                    <div class="metric-label">Utiliza√ß√£o de Mem√≥ria</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value good" id="cpuUsage">23%</div>
                    <div class="metric-label">Utiliza√ß√£o de CPU</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value good" id="apiRequests">1,247</div>
                    <div class="metric-label">Pedidos API (24h)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value good" id="errorRate">0.2%</div>
                    <div class="metric-label">Taxa de Erro</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h3>üìà Gr√°ficos de Performance</h3>
            <div class="chart-container">
                üìä Gr√°fico de CPU e Mem√≥ria (√öltimas 24h)
                <br><small>Integra√ß√£o com biblioteca de gr√°ficos em desenvolvimento</small>
            </div>
            <div class="chart-container">
                üìà Gr√°fico de Tempo de Resposta (√öltima semana)
                <br><small>Integra√ß√£o com biblioteca de gr√°ficos em desenvolvimento</small>
            </div>
        </div>

        <div class="section">
            <h3>üîß Performance das V√°lvulas</h3>
            <table class="performance-table">
                <thead>
                    <tr>
                        <th>V√°lvula</th>
                        <th>Status</th>
                        <th>Tempo Resposta</th>
                        <th>Ciclos Completados</th>
                        <th>Efici√™ncia</th>
                        <th>√öltima Actividade</th>
                    </tr>
                </thead>
                <tbody id="valvePerformanceTable">
                    <!-- Dados ser√£o carregados dinamicamente -->
                </tbody>
            </table>
        </div>

        <div class="section">
            <h3>‚ö° Ac√ß√µes de Optimiza√ß√£o</h3>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="optimizeSystem()">Optimizar Sistema</button>
                <button class="btn btn-success" onclick="clearCache()">Limpar Cache</button>
                <button class="btn btn-warning" onclick="restartServices()">Reiniciar Servi√ßos</button>
                <button class="btn btn-primary" onclick="generateReport()">Gerar Relat√≥rio</button>
            </div>
        </div>
    </main>

    <script>
        let performanceData = {
            valves: [
                {id: 1, name: 'Condensador 1', status: 'good', responseTime: 42, cycles: 156, efficiency: 98.5, lastActivity: '2 min'},
                {id: 2, name: 'Condensador 2', status: 'good', responseTime: 38, cycles: 142, efficiency: 97.8, lastActivity: '1 min'},
                {id: 3, name: 'Condensador 3', status: 'warning', responseTime: 67, cycles: 134, efficiency: 94.2, lastActivity: '5 min'},
                {id: 4, name: 'Condensador 4', status: 'critical', responseTime: 120, cycles: 89, efficiency: 85.1, lastActivity: '2h'},
                {id: 5, name: 'Condensador 5', status: 'good', responseTime: 45, cycles: 167, efficiency: 99.1, lastActivity: '30s'}
            ]
        };

        function renderValvePerformance() {
            const tbody = document.getElementById('valvePerformanceTable');
            tbody.innerHTML = performanceData.valves.map(valve => `
                <tr>
                    <td>${valve.name}</td>
                    <td>
                        <span class="status-indicator ${valve.status}"></span>
                        ${valve.status === 'good' ? '√ìptimo' : valve.status === 'warning' ? 'Aten√ß√£o' : 'Cr√≠tico'}
                    </td>
                    <td>${valve.responseTime}ms</td>
                    <td>${valve.cycles}</td>
                    <td>${valve.efficiency}%</td>
                    <td>${valve.lastActivity}</td>
                </tr>
            `).join('');
        }

        function updateMetrics() {
            // Simular varia√ß√µes nas m√©tricas
            const metrics = {
                systemUptime: (99.5 + Math.random() * 0.5).toFixed(1) + '%',
                responseTime: Math.floor(40 + Math.random() * 20) + 'ms',
                memoryUsage: Math.floor(60 + Math.random() * 20) + '%',
                cpuUsage: Math.floor(15 + Math.random() * 20) + '%',
                apiRequests: (1200 + Math.floor(Math.random() * 100)).toLocaleString(),
                errorRate: (Math.random() * 0.5).toFixed(1) + '%'
            };

            Object.keys(metrics).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = metrics[key];

                    // Actualizar classes baseado nos valores
                    element.className = 'metric-value';
                    if (key === 'memoryUsage' || key === 'cpuUsage') {
                        const value = parseInt(metrics[key]);
                        if (value > 80) element.classList.add('critical');
                        else if (value > 60) element.classList.add('warning');
                        else element.classList.add('good');
                    } else {
                        element.classList.add('good');
                    }
                }
            });
        }

        function optimizeSystem() {
            if (confirm('Iniciar optimiza√ß√£o do sistema? Esta opera√ß√£o pode demorar alguns minutos.')) {
                alert('Optimiza√ß√£o iniciada. O sistema ser√° optimizado em segundo plano.');

                // Simular melhoria nas m√©tricas
                setTimeout(() => {
                    alert('Optimiza√ß√£o conclu√≠da! Performance do sistema melhorada.');
                    updateMetrics();
                }, 3000);
            }
        }

        function clearCache() {
            if (confirm('Limpar cache do sistema?')) {
                alert('Cache limpo com sucesso! Tempo de resposta pode melhorar.');
                updateMetrics();
            }
        }

        function restartServices() {
            if (confirm('Reiniciar servi√ßos do sistema? Esta opera√ß√£o pode causar uma breve interrup√ß√£o.')) {
                alert('Servi√ßos reiniciados com sucesso!');
                updateMetrics();
            }
        }

        function generateReport() {
            const report = {
                timestamp: new Date().toISOString(),
                system_metrics: {
                    uptime: document.getElementById('systemUptime').textContent,
                    response_time: document.getElementById('responseTime').textContent,
                    memory_usage: document.getElementById('memoryUsage').textContent,
                    cpu_usage: document.getElementById('cpuUsage').textContent,
                    api_requests: document.getElementById('apiRequests').textContent,
                    error_rate: document.getElementById('errorRate').textContent
                },
                valve_performance: performanceData.valves
            };

            const blob = new Blob([JSON.stringify(report, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `iotcnt_performance_report_${new Date().toISOString().split('T')[0]}.json`;
            a.click();

            alert('Relat√≥rio de performance gerado e descarregado!');
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            renderValvePerformance();
            updateMetrics();

            // Actualizar m√©tricas a cada 10 segundos
            setInterval(updateMetrics, 10000);

            // Actualizar performance das v√°lvulas a cada 30 segundos
            setInterval(() => {
                performanceData.valves.forEach(valve => {
                    valve.responseTime += Math.floor((Math.random() - 0.5) * 10);
                    valve.responseTime = Math.max(20, Math.min(150, valve.responseTime));

                    valve.efficiency += (Math.random() - 0.5) * 2;
                    valve.efficiency = Math.max(80, Math.min(100, valve.efficiency));
                    valve.efficiency = Math.round(valve.efficiency * 10) / 10;
                });
                renderValvePerformance();
            }, 30000);
        });
    </script>
</body>
</html>
