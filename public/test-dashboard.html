<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testes Automatizados - IOTCNT</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .content {
            padding: 30px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .summary-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e9ecef;
        }

        .summary-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .summary-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .value-passed {
            color: #00b894;
        }

        .value-failed {
            color: #e17055;
        }

        .value-warning {
            color: #fdcb6e;
        }

        .value-total {
            color: #74b9ff;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00b894, #74b9ff);
            transition: width 0.5s ease;
        }

        .categories-section {
            margin-bottom: 30px;
        }

        .category-card {
            background: white;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .category-header {
            background: #74b9ff;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .category-title {
            font-size: 1.2em;
            font-weight: 600;
        }

        .category-stats {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
        }

        .category-content {
            padding: 20px;
            display: none;
        }

        .category-content.expanded {
            display: block;
        }

        .test-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #74b9ff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .test-item.passed {
            border-left-color: #00b894;
        }

        .test-item.failed {
            border-left-color: #e17055;
        }

        .test-item.warning {
            border-left-color: #fdcb6e;
        }

        .test-info {
            flex: 1;
        }

        .test-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .test-message {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .test-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .badge-passed {
            background: #d1f2eb;
            color: #00b894;
        }

        .badge-failed {
            background: #fadbd8;
            color: #e17055;
        }

        .badge-warning {
            background: #fef9e7;
            color: #fdcb6e;
        }

        .response-time {
            font-size: 0.8em;
            color: #7f8c8d;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .error {
            background: #ff7675;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .success {
            background: #00b894;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 20px;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .spinning {
            animation: spin 1s linear infinite;
        }

        @media (max-width: 768px) {
            .category-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .test-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Testes Automatizados</h1>
            <p>Sistema de Qualidade e Testes - IOTCNT</p>
        </div>

        <div class="content">
            <div class="controls">
                <button class="btn btn-primary" id="run-tests-btn" onclick="runTests()">
                    üöÄ Executar Todos os Testes
                </button>
                <button class="btn btn-success" onclick="runQuickTests()">
                    ‚ö° Testes R√°pidos
                </button>
                <button class="btn btn-warning" onclick="exportResults()">
                    üìä Exportar Resultados
                </button>
                <a href="/dashboard-admin.html" class="btn btn-primary">
                    ‚Üê Voltar ao Dashboard
                </a>
            </div>

            <div id="message-area"></div>

            <div class="summary-section" id="summary-section" style="display: none;">
                <h3>üìä Resumo dos Testes</h3>
                <div class="summary-grid">
                    <div class="summary-card">
                        <div class="summary-value value-total" id="total-tests">0</div>
                        <div class="summary-label">Total de Testes</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-value value-passed" id="passed-tests">0</div>
                        <div class="summary-label">Testes Aprovados</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-value value-failed" id="failed-tests">0</div>
                        <div class="summary-label">Testes Falhados</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-value value-warning" id="warning-tests">0</div>
                        <div class="summary-label">Avisos</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-value value-total" id="success-rate">0%</div>
                        <div class="summary-label">Taxa de Sucesso</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-value value-total" id="execution-time">0ms</div>
                        <div class="summary-label">Tempo de Execu√ß√£o</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                </div>
            </div>

            <div class="categories-section" id="categories-section">
                <div class="loading">
                    <p>üß™ Execute os testes para ver os resultados</p>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>&copy; 2025 IOTCNT - Sistema de Testes Automatizados | CNT</p>
        </div>
    </div>

    <script>
        let testResults = null;

        // Executar todos os testes
        async function runTests() {
            const runBtn = document.getElementById('run-tests-btn');
            runBtn.disabled = true;
            runBtn.innerHTML = 'üîÑ A executar testes...';
            runBtn.classList.add('spinning');

            showMessage('üß™ A executar suite completa de testes...', 'info');

            try {
                const response = await fetch('/test-suite.php?action=run');
                const data = await response.json();

                if (data.status === 'success') {
                    testResults = data.results;
                    displayResults(testResults);
                    showMessage('‚úÖ Testes executados com sucesso!', 'success');
                } else {
                    showError('Erro ao executar testes: ' + data.message);
                }
            } catch (error) {
                showError('Erro ao executar testes: ' + error.message);
            } finally {
                runBtn.disabled = false;
                runBtn.innerHTML = 'üöÄ Executar Todos os Testes';
                runBtn.classList.remove('spinning');
            }
        }

        // Executar testes r√°pidos
        async function runQuickTests() {
            showMessage('‚ö° A executar testes r√°pidos...', 'info');

            // Simular testes r√°pidos
            setTimeout(() => {
                showMessage('‚úÖ Testes r√°pidos conclu√≠dos!', 'success');
            }, 2000);
        }

        // Mostrar resultados
        function displayResults(results) {
            displaySummary(results.summary);
            displayCategories(results.categories);
        }

        // Mostrar resumo
        function displaySummary(summary) {
            document.getElementById('total-tests').textContent = summary.total;
            document.getElementById('passed-tests').textContent = summary.passed;
            document.getElementById('failed-tests').textContent = summary.failed;
            document.getElementById('warning-tests').textContent = summary.warnings;
            document.getElementById('success-rate').textContent = summary.success_rate + '%';
            document.getElementById('execution-time').textContent = summary.execution_time + 'ms';

            // Actualizar barra de progresso
            const progressFill = document.getElementById('progress-fill');
            progressFill.style.width = summary.success_rate + '%';

            // Mostrar sec√ß√£o de resumo
            document.getElementById('summary-section').style.display = 'block';
        }

        // Mostrar categorias
        function displayCategories(categories) {
            const container = document.getElementById('categories-section');

            container.innerHTML = Object.entries(categories).map(([key, category]) => `
                <div class="category-card">
                    <div class="category-header" onclick="toggleCategory('${key}')">
                        <div class="category-title">${category.category}</div>
                        <div class="category-stats">
                            <span>‚úÖ ${category.passed}</span>
                            <span>‚ùå ${category.failed}</span>
                            <span>‚ö†Ô∏è ${category.total - category.passed - category.failed}</span>
                        </div>
                    </div>
                    <div class="category-content" id="category-${key}">
                        ${category.tests.map(test => `
                            <div class="test-item ${test.status}">
                                <div class="test-info">
                                    <div class="test-name">${test.name}</div>
                                    <div class="test-message">${test.message}</div>
                                </div>
                                <div class="test-status">
                                    ${test.response_time ? `<div class="response-time">${Math.round(test.response_time)}ms</div>` : ''}
                                    <span class="status-badge badge-${test.status}">${test.status}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        // Alternar categoria
        function toggleCategory(categoryKey) {
            const content = document.getElementById(`category-${categoryKey}`);
            content.classList.toggle('expanded');
        }

        // Exportar resultados
        function exportResults() {
            if (!testResults) {
                showError('Execute os testes primeiro para exportar os resultados');
                return;
            }

            showMessage('üìä A exportar resultados...', 'info');

            // Criar relat√≥rio em texto
            let report = '=== RELAT√ìRIO DE TESTES IOTCNT ===\n\n';
            report += `Data: ${new Date().toLocaleString('pt-PT')}\n`;
            report += `Total de Testes: ${testResults.summary.total}\n`;
            report += `Aprovados: ${testResults.summary.passed}\n`;
            report += `Falhados: ${testResults.summary.failed}\n`;
            report += `Avisos: ${testResults.summary.warnings}\n`;
            report += `Taxa de Sucesso: ${testResults.summary.success_rate}%\n`;
            report += `Tempo de Execu√ß√£o: ${testResults.summary.execution_time}ms\n\n`;

            Object.entries(testResults.categories).forEach(([key, category]) => {
                report += `=== ${category.category.toUpperCase()} ===\n`;
                category.tests.forEach(test => {
                    report += `${test.status.toUpperCase()}: ${test.name} - ${test.message}\n`;
                });
                report += '\n';
            });

            // Download do relat√≥rio
            const blob = new Blob([report], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `iotcnt-test-report-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            showMessage('‚úÖ Relat√≥rio exportado com sucesso!', 'success');
        }

        // Mostrar mensagem
        function showMessage(message, type = 'info') {
            const messageArea = document.getElementById('message-area');
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';

            messageArea.innerHTML = `<div class="${className}">${message}</div>`;

            setTimeout(() => {
                messageArea.innerHTML = '';
            }, 5000);
        }

        // Mostrar erro
        function showError(message) {
            showMessage(message, 'error');
        }

        // Auto-expandir primeira categoria quando h√° resultados
        function autoExpandFirstCategory() {
            const firstCategory = document.querySelector('.category-content');
            if (firstCategory) {
                firstCategory.classList.add('expanded');
            }
        }

        // Executar testes automaticamente ao carregar (opcional)
        // document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>
